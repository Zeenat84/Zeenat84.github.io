---
title: "Class 4 Notes and Exercises"
author: ZN
date: "Date created: `r Sys.Date()`"
output: html_notebook
---

#LEARNING OBJECTIVE: Use ggplot2 along with its extensions to make charts that are * work ready*.

Topics to cover

Recap + Factor correction
Make simple charts
Scatter plot
Line charts
Column chart
Make facetted plots
Draw multiple geoms in one plot
Learn to make beautiful charts using
Aesthetics (alpha, colour etc.)
Scales
Theme
Labels and annotations
Save a plot
Some extensions
ggthemes
gganimate
ggforce
ggrepel
Build a complex chart together
Recap
DONT USE THE LEVELS FUNCTION TO SET levels.

Make simple charts
Lets scatter

```{r}
library(tidyverse); library(nycflights13)
hourlyDelay <- flights %>% 
    group_by(hour) %>% 
    summarise(meanDelay = mean(dep_delay, na.rm = T)) 
ggplot(data = hourlyDelay, mapping = aes(x = hour, y = meanDelay)) +
    geom_point()
```




#Just checking the data to see if the hour variable was calculated correctly in the flights dataset.
```{r}
flights %>% 
    mutate(newHour = lubridate::hour(time_hour)) %>% 
    filter(newHour == 1)
```


# Make a line chart
```{r}
ggplot(hourlyDelay, aes(x = hour, y = meanDelay)) +
    geom_line()
```


#Lets make a column chart (which in the real world is a bar chart).
```{r}
ggplot(hourlyDelay, aes(x = hour, y = meanDelay)) +
    geom_col()
```

#Now lets look at a histogram.
```{r}
ggplot(flights, aes(arr_delay)) +
    geom_histogram(bins = 200)
```

#Make a bar chart.
```{r}
ggplot(flights, aes(dest)) +
    geom_bar()
```

# Lets facet
```{r}
hourlyOriginDelay <- flights %>% 
    group_by(hour, origin) %>% 
    summarise(meanDelay = mean(dep_delay, na.rm = T))
hourlyOriginDelay
```

 
#Lets make a facetted scatter plot
```{r}
ggplot(hourlyOriginDelay, aes(x = hour, y = meanDelay)) +
    geom_point() +
    facet_wrap(~ origin)
```


#Class 5 exercises

##Task Set 1: Create simple charts
1. Create a histogram of arrival delay.
```{r}
flights %>% 
  ggplot(data = ., mapping = aes(arr_delay)) +
  geom_histogram()
```

2. Run the following code to create a stacked column chart. Set the argument position for `geom_col()` to "dodge" to display these bars next to each other instead of on top of each other.
```{r}
flights %>% 
    group_by(origin, month) %>% 
    summarise(meanDelay = mean(dep_delay, na.rm = T)) %>% 
    ggplot(aes(x = factor(month), y = meanDelay, fill = origin)) +
    geom_col(position = "dodge")
```
4. Create a scatter plot that compares arrival delay with departure delay. How would you describe the relationship between the two variables?
```{r}
flights %>% 
  ggplot(aes(x = arr_delay, y = dep_delay)) +
    geom_point()
```

5. Group the data by `day` to calculate the mean departure delay and pipe to a ggplot to create a line chart showing `day` on the x-axis and the mean departure delay on the y-axis. What questions come up when you look at this chart?
```{r}
flights %>%
  group_by(day) %>% 
  summarise(meanDelay = mean(dep_delay, na.rm = T)) %>% 
  ggplot(aes(x = day, y = meanDelay)) +
    geom_line()
```


##Task Set 2: Facets and multiple geoms
1. Create a facetted version of the histogram you made in the previous task set. You can pick a facet of your choice (remember that a facet should be a categorical variable)
```{r}
flights %>% 
  ggplot(data = ., mapping = aes(arr_delay)) +
  geom_histogram() +
  facet_wrap(~ origin)
```

2. The code below is the same as task 3 in the previous task set. Modify it to create a facetted version of the chart (instead of the stacked bars). Think about what variable you should use to facet. 
```{r}
flights %>% 
    group_by(origin, month) %>% 
    summarise(meanDelay = mean(dep_delay, na.rm = T)) %>% 
    ggplot(aes(x = factor(month), y = meanDelay, fill = origin)) +
    geom_col() +
    facet_wrap(~ origin)
```

3. Extend the scatter plot you made in the previous section by adding a `geom_smooth()` to it.
```{r}
flights %>% 
  ggplot(aes(x = arr_delay, y = dep_delay)) +
    geom_point() +
    geom_smooth()
```

4. How would you make the line generated by `geom_smooth()` linear (i.e. a straight line)
```{r}
flights %>% 
  ggplot(aes(x = arr_delay, y = dep_delay)) +
    geom_point() +
    geom_smooth(method = "lm")
```

